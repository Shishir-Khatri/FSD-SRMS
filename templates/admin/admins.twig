{% extends "layout/base.twig" %}

{% block title %}Manage Admins{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h2>Manage Admins</h2>
        <p class="text-muted">System Administrators with student management privileges</p>
    </div>
    <div>
        <a href="add.php?type=admin" class="btn-action btn-primary">
            <i class="bi bi-shield-plus"></i> Add New Admin
        </a>
    </div>
</div>

<div class="content-card mb-section">
    <div class="card-content">
         <form action="admins.php" method="GET" class="search-form-wrapper">
            <div class="input-wrapper">
                <span class="input-icon">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" name="q" id="search-input" class="form-input input-with-icon" placeholder="Search admin by username or email..." value="{{ query }}" autocomplete="off">
                <button class="btn-action btn-primary input-addon-btn" type="submit">Search</button>
                 {% if query %}
                <a href="admins.php" class="btn-action btn-secondary input-addon-btn">Clear</a>
                {% endif %}
            </div>
           <div id="autocomplete-list" class="suggestions-list"></div>
        </form>
    </div>
</div>

<div class="content-card">
    <div class="card-content p-0">
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th class="ps-4">Username</th>
                        <th>Email</th>
                        <th>Created At</th>
                        <th>Status</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for admin in admins %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ admin.username }}</td>
                        <td>{{ admin.email }}</td>
                        <td>{{ admin.created_at|date("M j, Y") }}</td>
                        <td>
                            {% if admin.is_active %}
                                <span class="badge badge-active">Active</span>
                            {% else %}
                                <span class="badge badge-inactive">Inactive</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="flex-center gap-sm justify-center">
                                <a href="edit_admin.php?id={{ admin.id }}" class="btn-action btn-sm btn-outline primary">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                <a href="delete.php?id={{ admin.id }}" class="btn-action btn-sm btn-outline danger" onclick="return confirm('Delete this admin? This cannot be undone.')">
                                    <i class="bi bi-trash"></i> Delete
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="empty-state">No admins found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% if pagination.total > 1 %}
    <div class="card-footer-bar flex-center">
         <div class="d-flex gap-xs">
             <a href="?q={{ query }}&page={{ pagination.prev_page }}" class="btn-action btn-sm btn-secondary {% if not pagination.has_prev %}disabled btn-disabled{% endif %}">Previous</a>
             
              {% for i in 1..pagination.total %}
             <a href="?q={{ query }}&page={{ i }}" class="btn-action btn-sm {% if pagination.current == i %}btn-primary{% else %}btn-secondary{% endif %}">{{ i }}</a>
             {% endfor %}
             
             <a href="?q={{ query }}&page={{ pagination.next_page }}" class="btn-action btn-sm btn-secondary {% if not pagination.has_next %}disabled btn-disabled{% endif %}">Next</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    const searchInput = document.getElementById('search-input');
    const autocompleteList = document.getElementById('autocomplete-list');

    searchInput.addEventListener('input', function() {
        const query = this.value;
        if (query.length < 1) {
            autocompleteList.innerHTML = '';
            return;
        }

        fetch(`admins.php?ajax=1&q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList.innerHTML = '';
                 if(data.length === 0) {
                     const div = document.createElement('div');
                     div.className = 'suggestion-item text-muted';
                     div.textContent = 'No results found';
                     autocompleteList.appendChild(div);
                     return;
                }
                data.forEach(item => {
                    const a = document.createElement('a');
                    // Filter list by this query to "search" for them
                    a.href = `admins.php?q=${encodeURIComponent(item.text.split(' (')[0])}`;
                    a.className = 'suggestion-item';
                    a.textContent = item.text;
                    autocompleteList.appendChild(a);
                });
            });
    });

    document.addEventListener('click', function(e) {
        if (e.target !== searchInput && e.target !== autocompleteList) {
            autocompleteList.innerHTML = '';
        }
    });
</script>
{% endblock %}
