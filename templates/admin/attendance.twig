{% extends "layout/base.twig" %}

{% block title %}Mark Attendance{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Attendance Management</h2>
</div>

{% if message %}
<div class="sms-notification notification-info">
    <span>{{ message }}</span>
    <button type="button" class="close-notification" onclick="this.parentElement.remove()">&times;</button>
</div>
{% endif %}

<div class="content-card">
    <div class="card-header-bar bg-light-header">
        <form method="GET" class="flex-center justify-start gap-md">
            <label class="mb-0 fw-bold">Select Date:</label>
            <input type="date" name="date" class="form-input w-auto" value="{{ date }}" onchange="this.form.submit()">
            <button type="submit" class="btn-action btn-primary btn-sm">Load</button>
        </form>
    </div>
    <div class="card-content">
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <input type="hidden" name="date" value="{{ date }}">
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in students %}
                        <tr>
                            <td>{{ student.last_name }}, {{ student.first_name }}</td>
                            <td>
                                <div class="attendance-toggle-group d-flex gap-sm">
                                    
                                    <!-- Custom Radio Style needs to be implemented or we use simple buttons with JS. 
                                         Ideally we map radio inputs to buttons. 
                                         For this task to stay pure CSS/HTML without extra JS, we will use Labels as buttons.
                                    -->
                                    <!-- Custom Radio Style -->

                                    <input type="radio" class="attendance-radio" name="attendance[{{ student.id }}]" id="present_{{ student.id }}" value="Present" {% if student.status == 'Present' or not student.status %}checked{% endif %}>
                                    <label class="attendance-label lbl-present" for="present_{{ student.id }}">Present</label>

                                    <input type="radio" class="attendance-radio" name="attendance[{{ student.id }}]" id="absent_{{ student.id }}" value="Absent" {% if student.status == 'Absent' %}checked{% endif %}>
                                    <label class="attendance-label lbl-absent" for="absent_{{ student.id }}">Absent</label>

                                    <input type="radio" class="attendance-radio" name="attendance[{{ student.id }}]" id="late_{{ student.id }}" value="Late" {% if student.status == 'Late' %}checked{% endif %}>
                                    <label class="attendance-label lbl-late" for="late_{{ student.id }}">Late</label>
                                    
                                     <input type="radio" class="attendance-radio" name="attendance[{{ student.id }}]" id="excused_{{ student.id }}" value="Excused" {% if student.status == 'Excused' %}checked{% endif %}>
                                    <label class="attendance-label lbl-excused" for="excused_{{ student.id }}">Excused</label>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="mt-section">
                <button type="submit" class="btn-action btn-primary btn-large">Save Attendance</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
